# アクセスログの整形

## Nginxのアクセスログからステータスコード200のみを絞り、hostでソートする
```log
[nginx] time:2022-01-03T17:58:33+09:00  server_addr:10.15.0.5   host:10.15.0.2  method:POST     reqsize:385     uri:/wp-cron.php?doing_wp_cron=1641200313.7922360897064208984375      query:doing_wp_cron=1641200313.7922360897064208984375   status:200      size:31 referer:https://blog.adachin.me/wp-cron.php?doing_wp_cron=1641200313.7922360897064208984375   ua:WordPress/5.8.2; https://blog.adachin.me  forwardedfor:-   reqtime:0.001   apptime:0.004
[nginx] time:2022-01-03T17:58:34+09:00  server_addr:10.15.0.5   host:185.191.171.16     method:GET      reqsize:303     uri:/archives/10835   query:q=/archives/10835&        status:200      size:26491      referer:-       ua:Mozilla/5.0 (compatible; SemrushBot/7~bl; +http://www.semrush.com/bot.html)        forwardedfor:-  reqtime:2.278   apptime:2.280
[nginx] time:2022-01-03T17:59:06+09:00  server_addr:10.15.0.5   host:10.15.0.2  method:POST     reqsize:385     uri:/wp-cron.php?doing_wp_cron=1641200346.7894539833068847656250      query:doing_wp_cron=1641200346.7894539833068847656250   status:200      size:31 referer:https://blog.adachin.me/wp-cron.php?doing_wp_cron=1641200346.7894539833068847656250   ua:WordPress/5.8.2; https://blog.adachin.me  forwardedfor:-   reqtime:0.001   apptime:0.004
[nginx] time:2022-01-03T17:59:08+09:00  server_addr:10.15.0.5   host:147.92.153.18      method:GET      reqsize:356     uri:/archives/tag/h2o/page/2  query:q=/archives/tag/h2o/page/2&       status:200      size:20008      referer:-       ua:Mozilla/5.0 (compatible; Linespider/1.1; +https://lin.ee/4dwXkTH)  forwardedfor:-  reqtime:2.834   apptime:2.832
[nginx] time:2022-01-03T17:59:06+09:00  server_addr:10.15.0.5   host:10.15.0.10  method:POST     reqsize:385     uri:/wp-cron.php?doing_wp_cron=1641200346.7894539833068847656250      query:doing_wp_cron=1641200346.7894539833068847656250   status:200      size:31 referer:https://blog.adachin.me/wp-cron.php?doing_wp_cron=1641200346.7894539833068847656250   ua:WordPress/5.8.2; https://blog.adachin.me  forwardedfor:-   reqtime:0.001   apptime:0.004
[nginx] time:2022-01-03T17:59:08+09:00  server_addr:10.15.0.10   host:147.92.153.18      method:GET      reqsize:356     uri:/archives/tag/h2o/page/2  query:q=/archives/tag/h2o/page/2&       status:200      size:20008      referer:-       ua:Mozilla/5.0 (compatible; Linespider/1.1; +https://lin.ee/4dwXkTH)  forwardedfor:-  reqtime:2.834   apptime:2.832
[nginx] time:2022-01-03T17:59:08+09:00  server_addr:10.15.0.11   host:147.92.153.18      method:GET      reqsize:356     uri:/archives/tag/h2o/page/2  query:q=/archives/tag/h2o/page/2&       status:200      size:20008      referer:-       ua:Mozilla/5.0 (compatible; Linespider/1.1; +https://lin.ee/4dwXkTH)  forwardedfor:-  reqtime:2.834   apptime:2.832
[nginx] time:2022-01-03T17:59:08+09:00  server_addr:10.15.0.11   host:147.92.153.18      method:GET      reqsize:356     uri:/archives/tag/h2o/page/2  query:q=/archives/tag/h2o/page/2&       status:200      size:20008      referer:-       ua:Mozilla/5.0 (compatible; Linespider/1.1; +https://lin.ee/4dwXkTH)  forwardedfor:-  reqtime:2.834   apptime:2.832
[nginx] time:2022-01-03T17:59:08+09:00  server_addr:10.15.0.22   host:147.92.153.18      method:GET      reqsize:356     uri:/archives/tag/h2o/page/2  query:q=/archives/tag/h2o/page/2&       status:200      size:20008      referer:-       ua:Mozilla/5.0 (compatible; Linespider/1.1; +https://lin.ee/4dwXkTH)  forwardedfor:-  reqtime:2.834   apptime:2.832
```

- コマンド例
```shell
$ cat access.log |grep status:200 |awk '{print $3,$9 }' |sort |uniq -c |sort -nr > fix_accesslog.txt
```
- 実行結果

```log
5 server_addr:10.15.0.5 status:200
      2 server_addr:10.15.0.11 status:200
      1 server_addr:10.15.0.22 status:200
      1 server_addr:10.15.0.10 status:200
```
